<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>RPG 2D estilo Roblox - Editor de mapas y nametags</title>
    <style>
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #1a1a2e;
            color: white;
            font-family: Arial, sans-serif;
        }
        canvas {
            border: 2px solid #0f3460;
            background: #16213e;
            margin-top: 20px;
            cursor: crosshair;
        }
        .controls {
            margin: 10px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }
        button {
            background: #0f3460;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        button.active {
            background: #e94560;
        }
        input {
            padding: 5px;
            border-radius: 5px;
            border: none;
        }
        label {
            font-size: 14px;
        }
        .info {
            margin: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>游 RPG 2D - Editor de mapas y Nametags</h1>
    <div class="controls">
        <div>
            <button id="editorBtn">九勇 Modo Editor: OFF</button>
            <span id="editorStatus" style="margin-left: 5px;">(Desactivado)</span>
        </div>
        <div>
            <label>游녻 Nametag:</label>
            <input type="text" id="nameInput" value="Aventurero" maxlength="20">
        </div>
        <div>
            <span>游닍 Tama침o del mapa: 10x10 (80x80px por tile)</span>
        </div>
    </div>
    <canvas id="gameCanvas" width="800" height="800"></canvas>
    <div class="info">
        <p>游몜游몛游몝游 WASD para moverte | En modo editor: clic izquierdo para colocar pared (gris), clic derecho para suelo (verde)</p>
    </div>

    <script>
        // ---------- Configuraci칩n ----------
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const TILE_SIZE = 80;          // 800/10 = 80px por tile
        const MAP_SIZE = 10;            // 10x10 tiles

        // Mapa: 0 = suelo (verde), 1 = pared (gris)
        let map = [];
        for (let i = 0; i < MAP_SIZE; i++) {
            map[i] = [];
            for (let j = 0; j < MAP_SIZE; j++) {
                map[i][j] = 0;          // Inicialmente todo suelo
            }
        }

        // Jugador
        let player = {
            x: 1,                       // Posici칩n en tiles (columna)
            y: 1,                       // fila
            name: "Aventurero"
        };

        // Editor
        let editorMode = false;
        const editorBtn = document.getElementById('editorBtn');
        const editorStatus = document.getElementById('editorStatus');
        const nameInput = document.getElementById('nameInput');

        // Para evitar el men칰 contextual con clic derecho
        canvas.addEventListener('contextmenu', (e) => e.preventDefault());

        // ---------- Actualizar nametag desde input ----------
        nameInput.addEventListener('input', (e) => {
            player.name = e.target.value || "Jugador";
        });

        // ---------- Bot칩n de modo editor ----------
        editorBtn.addEventListener('click', () => {
            editorMode = !editorMode;
            editorBtn.textContent = editorMode ? "九勇 Modo Editor: ON" : "九勇 Modo Editor: OFF";
            editorStatus.textContent = editorMode ? "(Activado)" : "(Desactivado)";
            editorBtn.classList.toggle('active', editorMode);
        });

        // ---------- Dibujar mapa y jugador ----------
        function draw() {
            // Fondo del canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Dibujar tiles
            for (let row = 0; row < MAP_SIZE; row++) {
                for (let col = 0; col < MAP_SIZE; col++) {
                    let x = col * TILE_SIZE;
                    let y = row * TILE_SIZE;

                    // Color seg칰n tipo
                    if (map[row][col] === 0) {
                        ctx.fillStyle = '#4caf50';   // suelo verde
                    } else {
                        ctx.fillStyle = '#9e9e9e';   // pared gris
                    }
                    ctx.fillRect(x, y, TILE_SIZE - 1, TILE_SIZE - 1); // -1 para ver la cuadr칤cula

                    // Borde
                    ctx.strokeStyle = '#555';
                    ctx.strokeRect(x, y, TILE_SIZE, TILE_SIZE);
                }
            }

            // Dibujar jugador (un c칤rculo)
            let playerX = player.x * TILE_SIZE + TILE_SIZE/2;
            let playerY = player.y * TILE_SIZE + TILE_SIZE/2;

            ctx.beginPath();
            ctx.arc(playerX, playerY, TILE_SIZE/3, 0, 2 * Math.PI);
            ctx.fillStyle = '#e94560';
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Dibujar nametag encima del jugador
            ctx.font = 'bold 16px Arial';
            ctx.fillStyle = 'white';
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 3;
            ctx.textAlign = 'center';
            ctx.strokeText(player.name, playerX, playerY - TILE_SIZE/2 - 5);
            ctx.fillText(player.name, playerX, playerY - TILE_SIZE/2 - 5);
        }

        // ---------- Movimiento con WASD (considerando colisiones) ----------
        document.addEventListener('keydown', (e) => {
            if (editorMode) return; // En modo editor no nos movemos

            let newX = player.x;
            let newY = player.y;

            switch(e.key) {
                case 'w': newY--; break;
                case 's': newY++; break;
                case 'a': newX--; break;
                case 'd': newX++; break;
                default: return;
            }

            // Verificar l칤mites del mapa
            if (newX < 0 || newX >= MAP_SIZE || newY < 0 || newY >= MAP_SIZE) return;

            // Verificar si la celda destino es suelo (0) - las paredes (1) bloquean
            if (map[newY][newX] === 0) {
                player.x = newX;
                player.y = newY;
            }

            draw();
        });

        // ---------- Eventos de clic para editar mapa ----------
        canvas.addEventListener('mousedown', (e) => {
            if (!editorMode) return;

            // Obtener coordenadas del clic relativas al canvas
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            const mouseX = (e.clientX - rect.left) * scaleX;
            const mouseY = (e.clientY - rect.top) * scaleY;

            const col = Math.floor(mouseX / TILE_SIZE);
            const row = Math.floor(mouseY / TILE_SIZE);

            if (col >= 0 && col < MAP_SIZE && row >= 0 && row < MAP_SIZE) {
                // Bot칩n izquierdo: pared (1), bot칩n derecho: suelo (0)
                if (e.button === 0) { // izquierdo
                    map[row][col] = 1;
                } else if (e.button === 2) { // derecho
                    map[row][col] = 0;
                }
                draw();
            }
        });

        // ---------- Inicializar con algunas paredes de ejemplo ----------
        function initMap() {
            // Paredes alrededor
            for (let i = 0; i < MAP_SIZE; i++) {
                map[0][i] = 1;           // fila superior
                map[MAP_SIZE-1][i] = 1;   // fila inferior
                map[i][0] = 1;            // columna izquierda
                map[i][MAP_SIZE-1] = 1;    // columna derecha
            }
            // Algunas paredes internas
            map[3][3] = 1;
            map[4][4] = 1;
            map[5][5] = 1;
            map[7][2] = 1;
            map[2][7] = 1;

            // Asegurar que el jugador empieza en suelo
            player.x = 5;
            player.y = 5;
            map[5][5] = 0; // si por casualidad era pared, la quitamos
        }

        initMap();
        draw();

        // ---------- Instrucciones extra ----------
        console.log('Juego cargado. Usa WASD para moverte. Activa el editor para pintar.');
    </script>
</body>
</html>
